<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up Page</title>
    <link rel="stylesheet" href="/stylesheets/signup.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

    <div class="main">
        <!-- Nav bar Starts here -->
        <%- include('./partials/navTop') %>

        <div class="content">
            <div class="center">
                <div class="left">
                    <h1>Sign Up <span>Now</span></h1>

                    <form class="form" action="/user/signup" method="post" onsubmit="return validateAndUpload(event)" enctype="multipart/form-data">
                        <div class="username">
                            <input type="text" placeholder="Enter The Username" class="text" name="username" id="username" autocomplete="off">
                        </div>

                        <div class="password">
                            <input type="password" placeholder="Enter Your Password" class="text" name="password" id="password" autocomplete="off">
                        </div>

                        <div class="email">
                            <input type="email" placeholder="Enter Your Email Id" class="text" name="email" id="emailID" autocomplete="off">
                        </div>

                        <div class="building">
                            <select name="buildingNumber" class="dropdown">
                                <option value="null">Please Select Your Building Number</option>
                                <option value="210">210</option>
                                <option value="110">110</option>
                                <option value="179">179</option>
                            </select>
                        </div>

                        <div class="room">
                            <select name="roomNumber" class="dropdown">
                                <option value="null">Please Select Your Room Number</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>

                        <div class="upload">
                            <p>Allotment Letter: </p>
                            <input type="file" class="form-control-file" id="allotmentFile" name="allotment" accept="application/pdf" required>
                        </div>

                        <div class="submit">
                            
                                <button type="submit" id="submitBtn">
                                    <div class="loader" ></div>
                                    <span id="btnText">Sign Up</span>
                                </button>
                           
                            
                        </div>
                    </form>
                </div>

                <div class="right">
                    <img src="/images/Artboard 2@4x 1.svg" alt="">
                </div>
            </div>
            <p><b>Do You Have an Account?</b> <a href="/login" id="test"><b>Login</b></a></p>
        </div>

        <script src="/javascripts/validateEmail.js"></script>

        <script>
            async function validateAndUpload(event) {

                event.preventDefault(); // Prevent default form submission

                const fileInput = document.getElementById('allotmentFile');
                const file = fileInput.files[0];
                const submitBtn = document.getElementById('submitBtn');
                const loader = document.querySelector('.loader');
                const btnText = document.getElementById('btnText');

                if (!file) {
                    alert("Please select a PDF file for the allotment letter!");
                    return false;
                }

                if (file.type !== 'application/pdf') {
                    alert("Only PDF files are allowed!");
                    return false;
                }

                const maxSize = 700 * 1024; // 700KB
                if (file.size > maxSize) {
                    alert("The file size should be less than 700KB!");
                    return false;
                }

                // Disable the submit button and show the loading spinner
                submitBtn.disabled = true;
                btnText.innerHTML = 'Signing Up...';
                loader.style.display = 'inline-block';

                // Proceed with the form submission
                event.target.submit();
                
            }
        </script>
    </div>
    
</body>
</html>
